@model List<DemoMVC.Models.TeacherModel>
@{
    ViewBag.Title = "Teacher";
    Layout = null;
}
<h3 class="text-center mt-0">*******************Teacher Data*******************</h3>
@if (ViewBag.Mess != null)
{
    <div class="text-center text-bg-success fw-bold">@ViewBag.Mess</div>
}
@if (ViewBag.Error != null)
{
    <div class="text-center text-bg-danger fw-bold">@ViewBag.Error</div>
}

<link rel="stylesheet" href="~/Content/bootstrap.min.css" />

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />


<!-- DataTables -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<div class="container-fluid">
    <form id="form" method="post">
        <input type="hidden" id="TxtId" name="Id" />
        <div class="row">
            <div class="col-sm-6">
                <label>Name</label>
                <input type="text" id="TxtName" name="name" class="form-control" placeholder="Enter The Name..." />
            </div>
            <div class="col-sm-6">
                <label>Class</label>
                <input type="text" id="TxtClass" name="class" class="form-control" placeholder="Enter The Class..." />
            </div>
        </div>
        <div class="col-sm-6">
            <label>Subject</label>
            <input type="text" id="TxtSubject" name="subject" class="form-control" placeholder="Enter The Subject..." />
        </div>
        <button type="submit" id="btnAdd" class="btn btn-primary">Add</button>
        <button type="button" id="btnUpdate" class="btn btn-success">Update</button>

    </form>

</div>
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-12">
            <div class="table-responsive">
                <table id="Teacherdata" class="table table-bordered table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>Id</th>
                            <th>Name</th>
                            <th>Class</th>
                            <th>Subject</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
@if (Model != null && Model.Count > 0)
{
    <table class="table table-bordered">
        <tr>
            <th>Id</th>
            <th>Name</th>
            <th>Class</th>
            <th>Subject</th>
            <th>Actions</th>
        </tr>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.Id</td>
                <td>@item.Name</td>
                <td>@item.Class</td>
                <td>@item.Subject</td>
                <td>
                    <button type="button" class="btn btn-danger btn-sm" onclick="DeleteTeacher('@item.Id')">Delete</button>
                    <button type="button" class="btn btn-warning btn-sm" onclick="EditTeacher('@item.Id','@item.Name','@item.Class','@item.Subject')">Edit</button>
                </td>
            </tr>
        }
    </table>
}


<script type="text/javascript">

    $(document).ready(function () {

        $('#btnUpdate').click(function () {
            debugger
            UpdateTeacher();

        })
        debugger
        GetTeacher();
        debugger
    });

    function GetTeacher() {
        debugger
        $.ajax({
            type: "POST",
            url: "/Teacher/GetTeacher",
            dataType: "json",
            success: function (response) {
                let result = JSON.parse(response);
                console.log(result);

                $('#Teacherdata').DataTable({
                    destroy: true,
                    data: result,

                    columns: [
                        { data: 'id' },
                        { data: 'name' },
                        { data: 'class' },
                        { data: 'subject' },

                       

                        {
                            data: null,
                            render: function (row) {
                                return `
                                     <button type="button" class="btn btn-danger btn-sm" onclick="DeleteTeacher(${row.id})">Delete</button>
                                     <button type="button" class="btn btn-primary btn-sm" onclick="EditTeacher('${row.id}','${row.name}','${row.class}','${row.subject}')">Edit</button>
                               `;
                            }

                        }
                    ],

                    // THIS PREVENTS JQUERY ERRORS
                    error: function (e) {
                        console.log("DataTable ERROR:", e);
                    }
                });
            },
            error: function (err) {
                debugger
                console.log("AJAX ERROR:", err.responseText);
            }
        });
    }







    function DeleteTeacher(id) {
        debugger
        if (confirm("You Want To Delete This Item?")) {
            debugger
            $.ajax({
                type: "post",
                url: "/Teacher/DeleteTeacher",
                data: JSON.stringify({ id: id }),
                dataType: "json",
                contentType: "application/json; charset=utf-8",

                success: function (response) {
                    debugger
                    if (response.result == "success") {
                        alert('Teacher Data Deleted Successfully!');
                       
                        location.reload();
                        GetTeacher();
                    }
                    else {
                        alert('Teacher Data Not Deleted');
                    }
                },
                error: function (xhr, status, error) {

                    console.log("Error:", error);
                    alert('Error while deleting record!');
                }
            });
        }
    }

    function EditTeacher(id, name, className, subject) {
        debugger
        $("#TxtId").val(id);
        $("#TxtName").val(name);
        $("#TxtClass").val(className);
        $("#TxtSubject").val(subject);
    }
    function UpdateTeacher() {
        debugger
        var id = $("#TxtId").val();
        var name = $("#TxtName").val();
        var className = $("#TxtClass").val();
        var subject = $("#TxtSubject").val();

        $.ajax({

            type: "post",
            url: "/Teacher/UpdateTeacher",
            data: JSON.stringify({
                id: id,
                name: name,
                Class: className,
                subject: subject
            }),
            dataType: "json",
            contentType: "application/json; charset=utf-8",

            success: function (response) {
                if (response === "success" || response.result === "success" || response.status === "success") {
                    alert('Data Updated Successfully!');
                   
                    location.reload();
                    GetTeacher();
                }
                else {
                    alert('Update failed, please try again.');
                }
            },

            error: function (xhr, status, error) {
                console.log("Ajax Error:", error);
                alert('Server error. Data may have been updated, please refresh and check.');
            }
        });
    }
</script>

